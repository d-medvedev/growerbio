On ltTmrEvt do
 GPIO [rlPins#lt],1
 Publish,%sysname%/status/lt,1
 LogEntry, 'Light is ON'
Endon

On MqAutoCtrl#ltAuto Do
TaskValueSet AutoCtrlSgs, lt,%eventvalue%
 Publish,%sysname%/status/auto_lt,%eventvalue% 
 If %eventvalue% = 1
  //TaskValueSet ManCtrlSgs,lt,0  
 Endif   
 If [AutoCtrlSgs#lt] = 0 And [ManCtrlSgs#lt] = 0
  GPIO [rlPins#lt],0
   Publish,%sysname%/status/lt,0
   TaskValueSet,TmEvtCntr,lt,0
 Endif
Endon

On MqLtSgs#dStrtHr do
 TaskValueSet LtSgs,dStrtHr,%eventvalue%
 TaskValueSet SgsUptodate,Sts,1
Endon

On MqLtSgs#dStrtMn do
 TaskValueSet LtSgs,dStrtMn,%eventvalue%
Endon

On MqLtSgs#dDrtn do
 TaskValueSet LtSgs,dDrtn,%eventvalue%
Endon

On MqLtSgs#Tzn do
 TaskValueSet LtSgs,Tzn,%eventvalue%
Endon

On MqRlCtrl#lt Do
TaskValueSet ManCtrlSgs,lt,%eventvalue%
GPIO [rlPins#lt],%eventvalue%
Publish,%sysname%/status/lt,%eventvalue%
Endon

On cfgLtTsk Do
If [LtSgs#dStrtHr] = 0
 TaskValueSet LtSgs,dStrtHr,6 
Endif
If [LtSgs#dStrtHr] = 0
 TaskValueSet LtSgs,dStrtMn,0
Endif
If [LtSgs#dDrtn] = 0
 TaskValueSet LtSgs,dDrtn,18
Endif
If [LtSgs#tZn] = 0
 TaskValueSet LtSgs, tZn,7
Endif
If [rlPins#lt] = 0
 TaskValueSet rlPins, lt,14
Endif
If [AutoCtrlSgs#lt] = 0 And [ManCtrlSgs#lt] = 0
 GPIO [rlPins#lt],0
 TaskValueSet AutoCtrlSgs, lt,1
Endif
Endon

On WiFi#Connected Do
  Publish %sysname%/status/sw_ver,[swVer#Maj].[swVer#Min].[swVer#Fix]
  Publish %sysname%/status/ip_addr,%ip%
  Publish %sysname%/status/sgs_status,[SgsUptodate#Sts]
Endon

on Time#Initialized do
TaskValueSet Wtr,Cntr,[WtrSgs#wtrCntr]*(%v7%-%v5%)/(([LtSgs#dDrtn]-[WtrSgs#wtrShft])*3600)
endon

On updDlSgs Do
 Publish,%sysname%/settings/day_start_hr,[LtSgs#dStrtHr]
 Publish,%sysname%/settings/day_start_min,[LtSgs#dStrtMn]
 Publish,%sysname%/settings/day_dur,[LtSgs#dDrtn]
 Publish %sysname%/settings/tzn,[LtSgs#tZn]
 Publish,%sysname%/settings/light_auto,[AutoCtrlSgs#lt]
 Publish %sysname%/status/sgs_status,[SgsUptodate#Sts]
Endon