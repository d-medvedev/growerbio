On ltTmrEvt do
 GPIO [rlPins#lt],1
 Publish,%sysname%/status/lt_switch,1
 LogEntry, 'Light is ON'
Endon

On MqAutoCtrl#ltAuto Do
TaskValueSet AutoCtrlSgs, lt,%eventvalue% 
 If %eventvalue% = 1
  TaskValueSet ManCtrlSgs,lt,0  
 Endif
 If [AutoCtrlSgs#lt] = 0 And [ManCtrlSgs#lt] = 0
  GPIO [rlPins#lt],0
   Publish,%sysname%/status/lt_switch,0
   TaskValueSet,TmEvtCntr,lt,0
 Endif
 Publish,%sysname%/status/auto_lt,%eventvalue% 
Endon

On MqLtSgs#dStrtHr do
 TaskValueSet LtSgs,dStrtHr,%eventvalue%
 Publish,%sysname%/status/day_start_hr,[LtSgs#dStrtHr]
 TaskValueSet SgsUptodate,Sts,1 
Endon

On MqLtSgs#dStrtMn do
 TaskValueSet LtSgs,dStrtMn,%eventvalue%
 Publish,%sysname%/status/day_start_min,[LtSgs#dStrtMn]
Endon

On MqLtSgs#dDrtn do
 TaskValueSet LtSgs,dDrtn,%eventvalue%
 Publish,%sysname%/status/day_dur,[LtSgs#dDrtn]
Endon

On MqLtSgs#Tzn do
 TaskValueSet LtSgs,Tzn,%eventvalue%
 Publish %sysname%/status/tzn,[LtSgs#tZn]
Endon

On MqRlCtrl#lt Do
TaskValueSet ManCtrlSgs,lt,%eventvalue%
TaskValueSet AutoCtrlSgs, lt,0  
GPIO [rlPins#lt],%eventvalue%
Publish,%sysname%/status/lt_switch,%eventvalue%
Publish,%sysname%/status/auto_lt,[AutoCtrlSgs#lt]
Endon

On cfgLtTsk Do
If [LtSgs#dStrtHr] = 0
 TaskValueSet LtSgs,dStrtHr,6 
Endif
If [LtSgs#dStrtHr] = 0
 TaskValueSet LtSgs,dStrtMn,0
Endif
If [LtSgs#dDrtn] = 0
 TaskValueSet LtSgs,dDrtn,18
Endif
If [LtSgs#tZn] = 0
 TaskValueSet LtSgs, tZn,7
Endif
If [rlPins#lt] = 0
 TaskValueSet rlPins, lt,14
Endif
If [AutoCtrlSgs#lt] = 0 And [ManCtrlSgs#lt] = 0
 GPIO [rlPins#lt],0
 TaskValueSet AutoCtrlSgs, lt,1
Endif
Endon

On WiFi#Connected Do
  Publish %sysname%/status/sw_ver,[swVer#Maj].[swVer#Min].[swVer#Fix]
  Publish %sysname%/status/ip_addr,%ip%
  Publish %sysname%/status/sgs_status,[SgsUptodate#Sts]
Endon

On updDlSgs Do
 Publish,%sysname%/status/day_start_hr,[LtSgs#dStrtHr]
 Publish,%sysname%/status/day_start_min,[LtSgs#dStrtMn]
 Publish,%sysname%/status/day_dur,[LtSgs#dDrtn]
 Publish %sysname%/status/tzn,[LtSgs#tZn]
 Publish,%sysname%/status/auto_lt,[AutoCtrlSgs#lt]
 Publish,%sysname%/status/lt_switch,%eventvalue%
 Publish %sysname%/status/sgs_status,[SgsUptodate#Sts]
Endon